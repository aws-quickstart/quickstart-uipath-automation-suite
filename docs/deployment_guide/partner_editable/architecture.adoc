:xrefstyle: short

Deploying this Quick Start with default parameters builds the following {partner-product-short-name} environment in the
AWS Cloud.

// Replace this example diagram with your own. Follow our wiki guidelines: https://w.amazon.com/bin/view/AWS_Quick_Starts/Process_for_PSAs/#HPrepareyourarchitecturediagram. Upload your source PowerPoint file to the GitHub {deployment name}/docs/images/ directory in its repository.

[#architecture1]
.Quick Start architecture for {partner-product-short-name} on AWS
image::../docs/deployment_guide/images/architecture_diagram.png[Architecture]

As shown in <<architecture1>>, this Quick Start sets up the following:

* A highly available architecture that spans two or more Availability Zones.
* A virtual private cloud (VPC) configured with public and private subnets, according to AWS best practices, to provide you with your own virtual network on AWS.
* In the public subnets:
 ** A Linux Bastion host to control inbound SSH (port 22) access to Amazon Elastic Compute Cloud (Amazon EC2) instances in the private subnets.
 ** Security groups for fine-grained inbound access to Bastion host instance.
* In the private subnets:
 ** An Amazon EC2 Auto Scaling group with Kubernetes server nodes. Nodes are hosted on Amazon EC2 instances running RedHat.
 ** An Amazon EC2 Auto Scaling group with Kubernetes agent nodes. Nodes are hosted on Amazon EC2 instances running RedHat.
 ** A database subnet group for Amazon Relational Database Service (Amazon RDS) DB instances running SQL Server.
 ** An Application Load Balancer or a Network Load Balancer to balance 443 inbound traffic between all Kubernetes nodes.
 ** An internal Network Load Balancer to balance 6443 (the kube API) and 9345 (the RKE2 registration address) traffic between the Kubernetes server nodes.
 ** Security groups for fine-grained access for the Kubernetes server nodes, as well as the agent nodes.
* AWS Certificate Manager for domain registration with a Secure Sockets Layer certificate.
* Amazon Route 53 as Domain Name System provider to route traffic to the Application Load Balancer.
* Multiple AWS Identity and Access Management (IAM) roles granting access to various operations required during deployment and installation.

[.small]#* The template that deploys this Quick Start into an existing VPC skips the components marked by asterisks and prompts you for your existing VPC configuration.#

=== Deployment and instance type mapping

The template dynamically computes the hardware needed for the deployment as follows:

* Depending on the services installed (basic or complete product selection), it sets minimum requirements at cluster level.
* Depending on the deployment profile (multi-node or single-node profile), it sets minimum requirements for a single VM.
* Selects the instance types based on their availability in the region you deploy and the aforementioned requirements.

The following table shows the mappings between deployment and possible instance types:

[cols="1,1"]
|===
| Deployment type | Instance type

| Basic single-node
| `+c5.4xlarge+`, `+c5a.4xlarge+`, `+m5.4xlarge+`, `+m5a.4xlarge+`

| Complete single-node
| `+c5a.8xlarge+`, `+c5.9xlarge+`, `+m5.8xlarge+`

| Basic multi-node
| `+c5.4xlarge+`, `+c5a.4xlarge+`, `+m5.4xlarge+`, `+m4.4xlarge+`

| Complete multi-node
| `+c5a.8xlarge+`, `+c5.9xlarge+`, `+m5.8xlarge+`, `+m5a.8xlarge+`
|===

=== Security groups and firewalls

When Amazon EC2 instances are launched, they must be associated with a security group, which acts as a stateful firewall. You have complete control over the security group's inbound and outbound network traffic. You can build granular rules that are scoped by protocol, port number, and source/destination IP address, or other security groups. By default, all outbound traffic from security group is permitted. Inbound traffic, however, must be configured to allow the appropriate traffic to reach your instances. We recommend that you tightly control inbound traffic. Doing this reduces the attack surface of your EC2 instances yet leaves the following ports open for application communication.

* Automation Suite ports:

|===
| Port | Protocol | Purpose

| 22
| TCP
| For SSH  (cluster management debugging)

| 443
| TCP
| For HTTPS (accessing Automation Suite)

| 2379
| TCP
| etcd client port

| 2380
| TCP
| etcd peer port

| 6443
| TCP
| For accessing Kube API using HTTPS, and required for node joining

| 8472
| TCP
| Required for Flannel (VXLAN)

| 9345
| TCP
| For accessing Kube API using HTTP, required for node joining

| 10250
| TCP
| kubelet / metrics server

| 30000-32767
| TCP
| Internal communication between nodes in a cluster
|===

* Other ports:
 ** 2049 - NFS service
 ** 1443 - RDS database instance port

This Quick Start configures the following security groups:

|===
| Security group | Associated with | Inbound source | Ports

| ServiceFabricSecurityGroup
| Server and Agent Autoscaling Groups and dedicated EC2 instances
| Private subnets CIDR
| Inbound: 443, 22, 6443, 9345, 8472, 10250, 2379, 2380, 8472, 30000-32767 +
Outbound: any ports

| BastionSecurityGroup
| Bastion host
| 0.0.0.0/0
| Inbound: 22 +
Outbound: any ports

| DbSecurityGroup
| RDS database instance
| Private subnets CIDR
| Inbound: 1443 +
Outbound: any ports

| SharedStorageSecurityGroup
| EFS volume
| Private subnets CIDR
| Inbound: 2049 +
Outbound: any ports

| ELBSecurityGroup
| Application Load Balancer
| 0.0.0.0/0
| Inbound: 443 +
Outbound: 443
|===